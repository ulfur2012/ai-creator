<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>AI Creator</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="app">
        <!-- Header -->
        <header id="app-header">
            <h1 id="header-title">AI Creator</h1>
            <button id="header-back" class="header-btn hidden" onclick="goBack()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
            </button>
        </header>

        <!-- Gallery View (Home) -->
        <div id="view-gallery" class="view active">
            <div class="view-header">
                <h2>Discover AIs</h2>
                <p class="subtitle">Browse published characters</p>
            </div>
            <div id="gallery-search">
                <input type="text" id="search-input" placeholder="Search characters..." oninput="filterGallery()">
            </div>
            <div id="gallery-grid" class="card-grid">
                <!-- Character cards inserted by JS -->
            </div>
            <div id="gallery-empty" class="empty-state hidden">
                <div class="empty-icon">
                    <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="12" cy="12" r="10"/><path d="M8 14s1.5 2 4 2 4-2 4-2"/><line x1="9" y1="9" x2="9.01" y2="9"/><line x1="15" y1="9" x2="15.01" y2="9"/></svg>
                </div>
                <h3>No AIs published yet</h3>
                <p>Create your first AI character and publish it!</p>
                <button class="btn btn-primary" onclick="showView('create')">Create AI</button>
            </div>
        </div>

        <!-- Create View -->
        <div id="view-create" class="view">
            <div class="view-header">
                <h2>Create AI</h2>
                <p class="subtitle">Give your character a face and personality</p>
            </div>
            <form id="create-form" onsubmit="handleCreateCharacter(event)">
                <div class="photo-upload" id="photo-upload" onclick="document.getElementById('photo-input').click()">
                    <div id="photo-preview" class="photo-preview">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><path d="M21 15l-5-5L5 21"/></svg>
                        <span>Tap to add photo</span>
                    </div>
                    <input type="file" id="photo-input" accept="image/*" capture="environment" onchange="handlePhotoUpload(event)" hidden>
                </div>

                <div class="form-group">
                    <label for="char-name">Character Name</label>
                    <input type="text" id="char-name" placeholder="e.g. Captain Whiskers" required maxlength="50">
                </div>

                <div class="form-group">
                    <label for="char-personality">How do they act?</label>
                    <textarea id="char-personality" placeholder="Describe their personality, how they talk, what they like... e.g. 'Talks like a pirate, loves treasure, always says arrr'" required maxlength="1000" rows="4"></textarea>
                    <span class="char-count"><span id="personality-count">0</span>/1000</span>
                </div>

                <div class="form-group">
                    <label for="char-greeting">First message (optional)</label>
                    <input type="text" id="char-greeting" placeholder="e.g. Ahoy there, matey!" maxlength="200">
                </div>

                <button type="submit" class="btn btn-primary btn-full">Create Character</button>
            </form>
        </div>

        <!-- My AIs View -->
        <div id="view-myais" class="view">
            <div class="view-header">
                <h2>My AIs</h2>
                <p class="subtitle">Your created characters</p>
            </div>
            <div class="myais-actions">
                <button class="btn btn-small" onclick="importCharacter()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                    Import
                </button>
            </div>
            <div id="myais-list" class="card-list">
                <!-- Character list inserted by JS -->
            </div>
            <div id="myais-empty" class="empty-state hidden">
                <div class="empty-icon">
                    <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg>
                </div>
                <h3>No characters yet</h3>
                <p>Create your first AI character!</p>
                <button class="btn btn-primary" onclick="showView('create')">Create AI</button>
            </div>
        </div>

        <!-- Chat View -->
        <div id="view-chat" class="view">
            <div id="chat-header">
                <img id="chat-avatar" src="" alt="">
                <div id="chat-info">
                    <h3 id="chat-name">Character</h3>
                    <span id="chat-status">Online</span>
                </div>
            </div>
            <div id="chat-messages">
                <!-- Messages inserted by JS -->
            </div>
            <div id="chat-input-area">
                <div id="chat-no-key" class="hidden">
                    <p>Add your API key in Settings to chat</p>
                    <button class="btn btn-small" onclick="showView('settings')">Go to Settings</button>
                </div>
                <form id="chat-form" onsubmit="handleSendMessage(event)">
                    <input type="text" id="chat-input" placeholder="Type a message..." autocomplete="off">
                    <button type="submit" id="chat-send-btn" class="btn-send">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
                    </button>
                </form>
            </div>
        </div>

        <!-- Settings View -->
        <div id="view-settings" class="view">
            <div class="view-header">
                <h2>Settings</h2>
                <p class="subtitle">Configure your API connection</p>
            </div>
            <div class="settings-section">
                <h3>AI Provider</h3>
                <div class="provider-select">
                    <label class="provider-option">
                        <input type="radio" name="provider" value="free" checked onchange="handleProviderChange(this.value)">
                        <span class="provider-card">
                            <strong>Free AI</strong>
                            <small>No key needed! Works instantly</small>
                        </span>
                    </label>
                    <label class="provider-option">
                        <input type="radio" name="provider" value="gemini" onchange="handleProviderChange(this.value)">
                        <span class="provider-card">
                            <strong>Google Gemini</strong>
                            <small>Free key, faster</small>
                        </span>
                    </label>
                    <label class="provider-option">
                        <input type="radio" name="provider" value="openai" onchange="handleProviderChange(this.value)">
                        <span class="provider-card">
                            <strong>OpenAI</strong>
                            <small>GPT-4o (paid key)</small>
                        </span>
                    </label>
                    <label class="provider-option">
                        <input type="radio" name="provider" value="anthropic" onchange="handleProviderChange(this.value)">
                        <span class="provider-card">
                            <strong>Anthropic</strong>
                            <small>Claude (paid key)</small>
                        </span>
                    </label>
                </div>
            </div>

            <div class="settings-section" id="api-key-section">
                <h3>API Key</h3>
                <div class="form-group">
                    <div class="api-key-input">
                        <input type="password" id="api-key-input" placeholder="Paste your API key here...">
                        <button type="button" class="btn-icon" onclick="toggleKeyVisibility()">
                            <svg id="eye-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
                        </button>
                    </div>
                    <button class="btn btn-primary btn-full" onclick="saveApiKey()" style="margin-top: 12px;">Save Key</button>
                </div>
                <p class="settings-note">Your key is stored locally in your browser and never sent anywhere except to the AI provider.</p>
            </div>

            <div class="settings-section" id="model-section">
                <h3>Model</h3>
                <div class="form-group">
                    <select id="model-select" onchange="handleModelChange(this.value)">
                        <optgroup label="Free AI" id="free-models">
                            <option value="openai">GPT (Default)</option>
                            <option value="mistral">Mistral</option>
                            <option value="deepseek">DeepSeek</option>
                        </optgroup>
                        <optgroup label="Google Gemini" id="gemini-models">
                            <option value="gemini-2.0-flash">Gemini 2.0 Flash</option>
                            <option value="gemini-2.0-flash-lite">Gemini 2.0 Flash Lite</option>
                            <option value="gemini-1.5-pro">Gemini 1.5 Pro</option>
                        </optgroup>
                        <optgroup label="OpenAI" id="openai-models">
                            <option value="gpt-4o">GPT-4o</option>
                            <option value="gpt-4o-mini">GPT-4o Mini</option>
                        </optgroup>
                        <optgroup label="Anthropic" id="anthropic-models">
                            <option value="claude-sonnet-4-6">Claude Sonnet 4.6</option>
                            <option value="claude-haiku-4-5-20251001">Claude Haiku 4.5</option>
                        </optgroup>
                    </select>
                </div>
            </div>

            <div class="settings-section">
                <h3>Chat</h3>
                <label class="toggle-option">
                    <span class="toggle-label">
                        <strong>Short replies</strong>
                        <small>AIs keep responses to ~5 sentences (still go longer for complex explanations)</small>
                    </span>
                    <input type="checkbox" id="short-replies-toggle" onchange="handleShortRepliesChange(this.checked)" checked>
                    <span class="toggle-slider"></span>
                </label>
            </div>

            <div class="settings-section">
                <h3>Data</h3>
                <button class="btn btn-danger" onclick="clearAllData()">Clear All Data</button>
                <p class="settings-note">This will delete all characters, chat history, and settings.</p>
            </div>
        </div>

        <!-- Bottom Navigation -->
        <nav id="bottom-nav">
            <button class="nav-btn active" data-view="gallery" onclick="showView('gallery')">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/></svg>
                <span>Gallery</span>
            </button>
            <button class="nav-btn" data-view="create" onclick="showView('create')">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="16"/><line x1="8" y1="12" x2="16" y2="12"/></svg>
                <span>Create</span>
            </button>
            <button class="nav-btn" data-view="myais" onclick="showView('myais')">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                <span>My AIs</span>
            </button>
            <button class="nav-btn" data-view="settings" onclick="showView('settings')">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-2 2 2 2 0 01-2-2v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83 0 2 2 0 010-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 01-2-2 2 2 0 012-2h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 010-2.83 2 2 0 012.83 0l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 012-2 2 2 0 012 2v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 0 2 2 0 010 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 012 2 2 2 0 01-2 2h-.09a1.65 1.65 0 00-1.51 1z"/></svg>
                <span>Settings</span>
            </button>
        </nav>
    </div>

    <!-- Toast notification -->
    <div id="toast" class="toast hidden"></div>

    <!-- Confirm dialog -->
    <div id="confirm-overlay" class="overlay hidden">
        <div class="confirm-dialog">
            <h3 id="confirm-title">Are you sure?</h3>
            <p id="confirm-message"></p>
            <div class="confirm-buttons">
                <button class="btn" onclick="closeConfirm()">Cancel</button>
                <button class="btn btn-danger" id="confirm-action">Delete</button>
            </div>
        </div>
    </div>

    <!-- Import file input (hidden) -->
    <input type="file" id="import-input" accept=".json" onchange="handleImportFile(event)" hidden>

    <script src="api.js"></script>
    <script src="app.js"></script>
</body>
</html>
